<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Miso's Whimsical Adventures</title>
<style>
  :root {
    /* Whimsical Theme Colors */
    --whimsical-bg-color: #f0f8ff; /* Alice Blue */
    --whimsical-slide-bg: #ffffff;
    --whimsical-text-color: #333366; /* Dark Slate Blue */
    --whimsical-heading-color: #6a5acd; /* Slate Blue */
    --whimsical-button-bg: #add8e6; /* Light Blue */
    --whimsical-button-text: #333366;
    --whimsical-button-hover-bg: #6a5acd;
    --whimsical-button-hover-text: #ffffff;
    --whimsical-bar-track: #e0e0f8; /* Light pastel lavender */
    --whimsical-bar-fill: #ff69b4; /* Hot Pink */
    --whimsical-bar-value-text: #ffffff;
  }

  body {
    margin: 0;
    font-family: 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', sans-serif;
    background-color: var(--whimsical-bg-color);
    color: var(--whimsical-text-color);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    overflow: hidden;
    line-height: 1.6;
  }

  h1 {
    color: var(--whimsical-heading-color);
    margin-bottom: 25px;
    font-size: 2.2em;
    text-shadow: 1px 1px 2px rgba(106, 90, 205, 0.3);
  }

  p {
    margin-bottom: 15px;
  }

  ul {
    list-style: none;
    padding-left: 0;
    margin-top: 20px;
  }

  li {
    margin-bottom: 12px;
    font-size: 1.15em;
    padding-left: 5px; /* Adjust for emoji visual alignment */
  }

  .slides-container {
    width: 85vw; /* Slightly wider than 70vh */
    max-width: 1000px;
    height: 65vh;
    max-height: 600px;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
  }

  .slide {
    background-color: var(--whimsical-slide-bg);
    border: 3px solid var(--whimsical-heading-color);
    border-radius: 20px;
    padding: 40px 60px;
    box-shadow: 0 8px 30px rgba(106, 90, 205, 0.2);
    width: 100%;
    height: 100%;
    box-sizing: border-box;
    display: none;
    flex-direction: column;
    justify-content: flex-start;
    align-items: flex-start;
    overflow-y: auto;
    transition: transform 0.5s ease-out, opacity 0.5s ease-out;
  }

  .slide.active {
    display: flex;
    transform: scale(1);
    opacity: 1;
  }

  .nav-button {
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    background-color: var(--whimsical-button-bg);
    color: var(--whimsical-button-text);
    border: 2px solid var(--whimsical-button-text);
    border-radius: 50%;
    width: 65px;
    height: 65px;
    font-size: 2.5em;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background-color 0.3s, color 0.3s, box-shadow 0.3s, border-color 0.3s;
    user-select: none;
    z-index: 1000;
    font-weight: bold;
  }

  .nav-button:hover:not(:disabled) {
    background-color: var(--whimsical-button-hover-bg);
    color: var(--whimsical-button-hover-text);
    border-color: var(--whimsical-button-hover-bg);
    box-shadow: 0 0 15px rgba(106, 90, 205, 0.4);
  }

  .nav-button:disabled {
    border-color: #cccccc;
    color: #cccccc;
    background-color: #f0f0f0;
    cursor: not-allowed;
    box-shadow: none;
  }

  #prevButton { left: 4vw; }
  #nextButton { right: 4vw; }

  /* Bar Chart Styles */
  .bar-chart {
    width: 100%;
    margin-top: 30px;
    display: flex;
    flex-direction: column;
    gap: 18px;
    padding-bottom: 20px;
  }

  .bar-row {
    display: flex;
    align-items: center;
    min-height: 45px;
  }

  .bar-label {
    width: 25%;
    flex-shrink: 0;
    margin-right: 20px;
    font-weight: bold;
    font-size: 1.1em;
  }

  .bar-track {
    flex-grow: 1;
    background-color: var(--whimsical-bar-track);
    height: 35px;
    border-radius: 8px;
    position: relative;
    overflow: hidden;
  }

  .bar-fill {
    height: 100%;
    background-color: var(--whimsical-bar-fill);
    width: 0%;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 12px;
    box-sizing: border-box;
    transition: width 0.8s ease-out;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
  }

  .bar-value {
    color: var(--whimsical-bar-value-text);
    font-weight: bold;
    font-size: 1em;
    text-shadow: 0 0 3px rgba(0,0,0,0.4);
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .slides-container {
      width: 95vw;
      height: 75vh;
    }
    .slide {
      padding: 30px 40px;
      border-width: 2px;
    }
    h1 {
      font-size: 1.8em;
      margin-bottom: 20px;
    }
    li {
      font-size: 1em;
      margin-bottom: 10px;
    }
    .nav-button {
      width: 50px;
      height: 50px;
      font-size: 2em;
    }
    #prevButton { left: 2vw; }
    #nextButton { right: 2vw; }
    .bar-label {
      width: 30%;
      margin-right: 10px;
      font-size: 0.9em;
    }
    .bar-track {
      height: 30px;
    }
    .bar-value {
      font-size: 0.8em;
    }
  }

  @media (max-width: 480px) {
    .slide {
      padding: 20px 25px;
    }
    h1 {
      font-size: 1.5em;
      margin-bottom: 15px;
    }
    .nav-button {
      width: 40px;
      height: 40px;
      font-size: 1.5em;
    }
    .bar-row {
      flex-direction: column;
      align-items: flex-start;
      gap: 5px;
    }
    .bar-label {
      width: 100%;
      margin-bottom: 5px;
      font-size: 0.9em;
    }
    .bar-track {
      width: 100%;
      height: 25px;
    }
  }

</style>
</head>
<body>

<button id="prevButton" class="nav-button" aria-label="Previous Slide">â—€</button>
<button id="nextButton" class="nav-button" aria-label="Next Slide">â–¶</button>

<div class="slides-container"></div>

<script>
const allSlidesContent = [
  "# Introducing Miso: The Curious Kitten\n- Miso is a tiny gray kitten living in a sunlit town.\n- He possesses an insatiable curiosity about everything around him.\n- Leaves, shadows, and bells on collars all spark his interest.\n- Despite his enthusiasm, Miso has a small problem: he's clumsy.\n- His pounces often end in an adorable tumble.",
  "# Miso's Tumble and the Red Ball\n- One morning, Miso spotted a bright red ball rolling down a path.\n- He eagerly pounced, but his clumsiness led him to tumble with it.\n- Instead of frustration, his journey became a series of bounces and rolls.\n- The red ball guided him on an unexpected adventure.\n- His playful tumble eventually led him to a soft, colorful destination.",
  "# A Field of Flowers: A Clumsy Landing\n- Miso's tumble concluded with a soft landing in a pile of vibrant flowers.\n- A gentle breeze scattered petals, making him look like a fluffy flower monster.\n- His accidental journey turned into a whimsical, beautiful moment.\n- The clumsy landing brought him unexpected delight and a picturesque scene.\n- He found himself surrounded by fragrant blossoms.",
  "# Poppy Joins the Fun\n- Suddenly, Miso's best friend, Poppy the calico cat, appeared.\n- Poppy \"giggled\" at Miso's charming, petal-covered appearance.\n- She quickly joined him amidst the soft pile of flowers.\n- Together, they began batting the bright red ball back and forth.\n- Their shared joy amplified the playful atmosphere.",
  "# Adventures in the Sunlit Town\n- Miso and Poppy chased the red ball all over their sunlit town.\n- Their playful pursuit took them through lush gardens.\n- They explored hidden spots, darting under fences with ease.\n- The adventure led them around the grand fountain in the town square.\n- Their day was filled with delightful discoveries and energetic play.",
  "# Friendship and Future Dreams\n- As the sun set, both Miso and Poppy were wonderfully exhausted.\n- Their fur was lightly dusted with petals and a little bit of dirt from their adventures.\n- They found a warm patch of sunlight and curled up together.\n- Their tiny paws intertwined, a testament to their deep friendship.\n- They drifted off to sleep, dreaming of more exciting escapades to come."
];

const slidesContainer = document.querySelector('.slides-container');
let currentSlideIndex = 0;
// Chosen emoji for 'whimsical' style, reflecting flowers from the story.
const emojiBullet = 'ðŸŒ¸';

/**
 * Creates a slide element from markdown content.
 * Handles titles, bullet points, and bar chart blocks.
 * @param {string} content - Markdown content for the slide.
 * @returns {HTMLElement} The created slide div element.
 */
function createSlideElement(content) {
  const slide = document.createElement('div');
  slide.className = 'slide';

  // Extract H1 title (first line starting with '#')
  const h1Match = content.match(/^#\s*(.*)/m);
  const title = h1Match ? h1Match[1].trim() : '';
  if (title) {
    const h1 = document.createElement('h1');
    h1.textContent = title;
    slide.appendChild(h1);
  }

  // Check for bar chart block
  const barChartMatch = content.match(/```bar\s*([\s\S]*?)\s*```/);

  if (barChartMatch) {
    // This slide contains a bar chart. Create the container for it.
    const barDiv = document.createElement('div');
    barDiv.className = 'bar-chart';
    barDiv.setAttribute('role', 'img');
    // Provide a descriptive aria-label for accessibility
    barDiv.setAttribute('aria-label', title ? `${title} bar chart` : 'Data visualization bar chart');
    barDiv.dataset.chartData = barChartMatch[1].trim(); // Store raw data for lazy rendering
    slide.appendChild(barDiv);
    console.info('Parsed a bar chart slide: ' + (title || 'Untitled chart'));
  } else {
    // If no bar chart, parse bullet points
    // Lines starting with '-'
    const bulletLines = content.split('\n').filter(line => line.trim().startsWith('-'));
    if (bulletLines.length > 0) {
      const ul = document.createElement('ul');
      bulletLines.forEach(line => {
        const li = document.createElement('li');
        // Insert emoji directly into the list item text
        li.textContent = emojiBullet + ' ' + line.replace(/^\s*-\s*/, '').trim();
        ul.appendChild(li);
      });
      slide.appendChild(ul);
    } else if (!h1Match) {
      // If no H1 and no bullets, add content as paragraph(s)
      const paragraphs = content.split('\n').filter(line => line.trim() !== '');
      paragraphs.forEach(pText => {
        const p = document.createElement('p');
        p.textContent = pText.trim();
        slide.appendChild(p);
      });
    }
  }
  return slide;
}

// Populate the slides container
allSlidesContent.forEach(content => {
  slidesContainer.appendChild(createSlideElement(content));
});

const slides = document.querySelectorAll('.slide');
const prevButton = document.getElementById('prevButton');
const nextButton = document.getElementById('nextButton');

// Minimum percentage width for a bar to be visible, even if its value is very small.
const MIN_VISIBLE_PERCENT = 1.5;

/**
 * Renders a bar chart inside the provided container.
 * This function is idempotent, meaning it won't render twice if called repeatedly.
 * @param {HTMLElement} barDiv - The div element with class 'bar-chart' and data-chartData.
 */
function renderBarChart(barDiv) {
  // Check if chart is already rendered to ensure idempotence
  if (barDiv.dataset.rendered === '1') {
    console.info('Bar chart already rendered, skipping.');
    return;
  }

  const rawData = barDiv.dataset.chartData;
  if (!rawData) {
    console.warn('Bar chart container found but no chart data (data-chartData attribute) was present.');
    return;
  }

  const chartData = [];
  const lines = rawData.split('\n').map(l => l.trim()).filter(l => l.length > 0);
  let maxValue = 0; // Initialize max value to determine bar scaling

  // Parse each line of the bar chart data
  lines.forEach(line => {
    const idx = line.indexOf(':');
    if (idx === -1) {
      console.warn(`Bar Chart Warning: Skipping invalid line (missing colon): "${line}"`);
      return;
    }
    const label = line.slice(0, idx).trim();
    // Remove commas for number parsing, supporting locales like "1,234.56"
    const valueStr = line.slice(idx + 1).trim().replace(/,/g, '');
    const value = parseFloat(valueStr);

    if (isNaN(value)) {
      console.warn(`Bar Chart Warning: Skipping invalid number format in line: "${line}"`);
      return;
    }
    chartData.push({ label, value });
    if (value > maxValue) {
      maxValue = value;
    }
  });

  // Clear previous content and render new bars
  barDiv.innerHTML = '';
  console.info(`Bar chart parsed with maxValue: ${maxValue}`);

  if (chartData.length === 0) {
    barDiv.textContent = 'No valid data to display for this chart.';
    barDiv.dataset.rendered = '1';
    return;
  }

  chartData.forEach(item => {
    let widthPercent = 0;
    if (maxValue > 0) {
      // Linear scaling: (value / maxValue) * 100
      widthPercent = (item.value / maxValue) * 100;
      // Apply minimum visible percentage for non-zero values
      if (item.value > 0 && widthPercent < MIN_VISIBLE_PERCENT) {
        widthPercent = MIN_VISIBLE_PERCENT;
      }
    } else if (item.value > 0) {
      // If maxValue is 0 or negative but current value is positive, still show MIN_VISIBLE_PERCENT
      widthPercent = MIN_VISIBLE_PERCENT;
    }

    const barRow = document.createElement('div');
    barRow.className = 'bar-row';
    // Add tooltip for extra information
    barRow.title = `${item.label} â€” ${item.value.toLocaleString()}`;
    barRow.innerHTML = `
      <span class="bar-label">${item.label}</span>
      <div class="bar-track">
        <div class="bar-fill" style="width:0%;">
          <span class="bar-value">${item.value.toLocaleString()}</span>
        </div>
      </div>`;
    barDiv.appendChild(barRow);

    // Apply width with a slight delay to trigger CSS transition animation
    const fill = barRow.querySelector('.bar-fill');
    if (fill) {
      setTimeout(() => {
        fill.style.width = widthPercent + '%';
      }, 50); // Small delay to ensure initial render is 0% before transition
    }
  });

  // Mark as rendered to prevent future re-renders
  barDiv.dataset.rendered = '1';
}

/**
 * Displays the slide at the given index and updates navigation buttons.
 * @param {number} idx - The index of the slide to show.
 */
function showSlide(idx) {
  if (idx < 0 || idx >= slides.length) {
    return; // Prevent out-of-bounds access
  }

  // Hide all slides
  slides.forEach(s => s.classList.remove('active'));

  // Show the target slide
  slides[idx].classList.add('active');
  currentSlideIndex = idx;

  // Update navigation button states
  prevButton.disabled = idx === 0;
  nextButton.disabled = idx === slides.length - 1;

  // If the active slide contains a bar chart, render it
  const bar = slides[idx].querySelector('.bar-chart');
  if (bar) {
    // Render with a slight delay to ensure slide layout is settled
    setTimeout(() => {
      renderBarChart(bar);
    }, 100);
  }
}

// Add event listeners for navigation buttons
prevButton.addEventListener('click', () => showSlide(currentSlideIndex - 1));
nextButton.addEventListener('click', () => showSlide(currentSlideIndex + 1));

// Add keyboard navigation
document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowRight' || e.key === ' ') {
    showSlide(currentSlideIndex + 1);
  } else if (e.key === 'ArrowLeft') {
    showSlide(currentSlideIndex - 1);
  }
});

// Initialize the presentation by showing the first slide
showSlide(0);
</script>
</body>
</html>